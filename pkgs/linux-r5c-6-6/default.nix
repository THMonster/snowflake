{ lib, stdenv, buildLinux, fetchurl, ... } @ args:

let
  kernelConfig = ''
    64BIT y
    ARCH_BINFMT_ELF_EXTRA_PHDRS y
    ARCH_CORRECT_STACKTRACE_ON_KRETPROBE y
    ARCH_DMA_ADDR_T_64BIT y
    ARCH_FORCE_MAX_ORDER 11
    ARCH_HIBERNATION_POSSIBLE y
    ARCH_KEEP_MEMBLOCK y
    ARCH_MHP_MEMMAP_ON_MEMORY_ENABLE y
    ARCH_MMAP_RND_BITS 18
    ARCH_MMAP_RND_BITS_MAX 33
    ARCH_MMAP_RND_BITS_MIN 18
    ARCH_MMAP_RND_COMPAT_BITS_MIN 11
    ARCH_NR_GPIO 0
    ARCH_PROC_KCORE_TEXT y
    ARCH_ROCKCHIP y
    ARCH_SPARSEMEM_ENABLE y
    ARCH_STACKWALK y
    ARCH_SUSPEND_POSSIBLE y
    ARCH_WANTS_NO_INSTR y
    ARCH_WANTS_THP_SWAP y
    ARC_EMAC_CORE y
    ARM64 y
    ARM64_4K_PAGES y
    ARM64_CNP y
    ARM64_EPAN y
    ARM64_ERRATUM_2051678 y
    ARM64_ERRATUM_2054223 y
    ARM64_ERRATUM_2067961 y
    ARM64_ERRATUM_2077057 y
    ARM64_ERRATUM_2658417 y
    ARM64_ERRATUM_819472 y
    ARM64_ERRATUM_824069 y
    ARM64_ERRATUM_826319 y
    ARM64_ERRATUM_827319 y
    ARM64_ERRATUM_832075 y
    ARM64_ERRATUM_843419 y
    ARM64_ERRATUM_858921 y
    ARM64_HW_AFDBM y
    ARM64_LD_HAS_FIX_ERRATUM_843419 y
    ARM64_PAGE_SHIFT 12
    ARM64_PAN y
    ARM64_PA_BITS 48
    ARM64_PA_BITS_48 y
    ARM64_PTR_AUTH y
    ARM64_PTR_AUTH_KERNEL y
    ARM64_RAS_EXTN y
    ARM64_SME y
    ARM64_SVE y
    ARM64_TAGGED_ADDR_ABI y
    ARM64_VA_BITS 48
    ARM64_VA_BITS_48 y
    ARM64_WORKAROUND_CLEAN_CACHE y
    ARM64_WORKAROUND_TSB_FLUSH_FAILURE y
    ARM_AMBA y
    ARM_ARCH_TIMER y
    ARM_ARCH_TIMER_EVTSTREAM y
    ARM_ARCH_TIMER_OOL_WORKAROUND y
    ARM_GIC y
    ARM_GIC_V2M y
    ARM_GIC_V3 y
    ARM_GIC_V3_ITS y
    ARM_GIC_V3_ITS_PCI y
    ARM_MHU y
    ARM_MHU_V2 y
    ARM_PSCI_CPUIDLE y
    ARM_PSCI_CPUIDLE_DOMAIN y
    ARM_PSCI_FW y
    ARM_SCMI_CPUFREQ y
    ARM_SCMI_HAVE_SHMEM y
    ARM_SCMI_HAVE_TRANSPORT y
    ARM_SCMI_POWER_CONTROL y
    ARM_SCMI_POWER_DOMAIN y
    ARM_SCMI_PROTOCOL y
    ARM_SCMI_TRANSPORT_MAILBOX y
    ARM_SCMI_TRANSPORT_SMC y
    ARM_SCMI_TRANSPORT_SMC_ATOMIC_ENABLE y
    ARM_SCPI_CPUFREQ y
    ARM_SCPI_POWER_DOMAIN y
    ARM_SCPI_PROTOCOL y
    ARM_SMMU y
    ARM_SMMU_DISABLE_BYPASS_BY_DEFAULT y
    ARM_SMMU_V3 y
    AUDIT_ARCH_COMPAT_GENERIC y
    BACKLIGHT_CLASS_DEVICE y
    BACKLIGHT_GPIO y
    BACKLIGHT_PWM y
    BLK_DEV_BSG y
    BLK_DEV_BSGLIB y
    BLK_DEV_BSG_COMMON y
    BLK_DEV_INTEGRITY y
    BLK_DEV_INTEGRITY_T10 y
    BLK_DEV_LOOP y
    BLK_DEV_NVME y
    BLK_DEV_PCIESSD_MTIP32XX y
    BLK_DEV_SD y
    BLK_MQ_PCI y
    BLK_PM y
    BRCMSTB_GISB_ARB y
    BSD_PROCESS_ACCT y
    BSD_PROCESS_ACCT_V3 y
    CC_HAVE_SHADOW_CALL_STACK y
    CC_HAVE_STACKPROTECTOR_SYSREG y
    CC_IMPLICIT_FALLTHROUGH "-Wimplicit-fallthrough=5"
    CC_NO_ARRAY_BOUNDS y
    CHARGER_GPIO y
    CLKSRC_MMIO y
    CLK_PX30 y
    CLK_RK3308 y
    CLK_RK3328 y
    CLK_RK3368 y
    CLK_RK3399 y
    CLK_RK3568 y
    CLONE_BACKWARDS y
    CMA y
    CMA_ALIGNMENT 8
    CMA_AREAS 7
    CMA_SIZE_MBYTES 16
    CMA_SIZE_SEL_MBYTES y
    COMMON_CLK y
    COMMON_CLK_RK808 y
    COMMON_CLK_ROCKCHIP y
    COMMON_CLK_SCMI y
    COMMON_CLK_SCPI y
    COMPACT_UNEVICTABLE_DEFAULT 1
    COMPAT_32BIT_TIME y
    CONFIGFS_FS y
    CONSOLE_TRANSLATIONS y
    CONTEXT_TRACKING y
    CONTEXT_TRACKING_IDLE y
    CONTIG_ALLOC y
    CPUFREQ_DT y
    CPUFREQ_DT_PLATDEV y
    CPU_FREQ y
    CPU_FREQ_DEFAULT_GOV_SCHEDUTIL y
    CPU_FREQ_GOV_ATTR_SET y
    CPU_FREQ_GOV_PERFORMANCE y
    CPU_FREQ_GOV_POWERSAVE y
    CPU_FREQ_GOV_SCHEDUTIL y
    CPU_FREQ_STAT y
    CPU_IDLE y
    CPU_IDLE_GOV_MENU y
    CPU_IDLE_MULTIPLE_DRIVERS y
    CPU_ISOLATION y
    CPU_LITTLE_ENDIAN y
    CPU_PM y
    CPU_RMAP y
    CPU_THERMAL y
    CRASH_CORE y
    CRASH_DUMP y
    CRC16 y
    CRC32_SLICEBY8 y
    CRC64 y
    CRC64_ROCKSOFT y
    CRC_T10DIF y
    CROSS_MEMORY_ATTACH y
    CRYPTO_AES_ARM64 y
    CRYPTO_AES_ARM64_CE y
    CRYPTO_AES_ARM64_CE_BLK y
    CRYPTO_AES_ARM64_CE_CCM y
    CRYPTO_CRC32 y
    CRYPTO_CRC32C y
    CRYPTO_CRC64_ROCKSOFT y
    CRYPTO_CRCT10DIF y
    CRYPTO_CRCT10DIF_ARM64_CE y
    CRYPTO_CRYPTD y
    CRYPTO_GHASH_ARM64_CE y
    CRYPTO_HW y
    CRYPTO_LIB_BLAKE2S_GENERIC y
    CRYPTO_LIB_SHA1 y
    CRYPTO_LIB_UTILS y
    CRYPTO_POLYVAL y
    CRYPTO_POLYVAL_ARM64_CE y
    CRYPTO_RNG2 y
    CRYPTO_SM3 y
    CRYPTO_SM3_NEON y
    CRYPTO_SM4 y
    CRYPTO_SM4_ARM64_CE_BLK y
    CRYPTO_SM4_ARM64_NEON_BLK y
    DCACHE_WORD_ACCESS y
    DEBUG_BUGVERBOSE y
    DEBUG_INFO y
    DEVFREQ_GOV_PERFORMANCE y
    DEVFREQ_GOV_POWERSAVE y
    DEVFREQ_GOV_SIMPLE_ONDEMAND y
    DEVFREQ_GOV_USERSPACE y
    DEVMEM y
    DMADEVICES y
    DMA_CMA y
    DMA_DIRECT_REMAP y
    DMA_ENGINE y
    DMA_OF y
    DMA_OPS y
    DMA_SHARED_BUFFER y
    DNOTIFY y
    DTC y
    DT_IDLE_GENPD y
    DT_IDLE_STATES y
    DUMMY_CONSOLE y
    DWMAC_DWC_QOS_ETH y
    DWMAC_GENERIC y
    DWMAC_ROCKCHIP y
    DW_WATCHDOG y
    EDAC_SUPPORT y
    EEPROM_AT24 y
    EMAC_ROCKCHIP y
    ENERGY_MODEL y
    EXCLUSIVE_SYSTEM_RAM y
    EXT4_FS y
    EXT4_FS_POSIX_ACL y
    EXTCON y
    F2FS_FS y
    FANOTIFY y
    FHANDLE y
    FIXED_PHY y
    FIX_EARLYCON_MEM y
    FRAME_POINTER y
    FRAME_WARN 2048
    FS_IOMAP y
    FS_MBCACHE y
    FS_POSIX_ACL y
    FWNODE_MDIO y
    FW_LOADER_PAGED_BUF y
    FW_LOADER_SYSFS y
    GCC11_NO_ARRAY_BOUNDS y
    GCC_SUPPORTS_DYNAMIC_FTRACE_WITH_REGS y
    GENERIC_ALLOCATOR y
    GENERIC_ARCH_TOPOLOGY y
    GENERIC_BUG y
    GENERIC_BUG_RELATIVE_POINTERS y
    GENERIC_CLOCKEVENTS y
    GENERIC_CLOCKEVENTS_BROADCAST y
    GENERIC_CPU_AUTOPROBE y
    GENERIC_CPU_VULNERABILITIES y
    GENERIC_CSUM y
    GENERIC_EARLY_IOREMAP y
    GENERIC_GETTIMEOFDAY y
    GENERIC_IDLE_POLL_SETUP y
    GENERIC_IOREMAP y
    GENERIC_IRQ_CHIP y
    GENERIC_IRQ_EFFECTIVE_AFF_MASK y
    GENERIC_IRQ_MIGRATION y
    GENERIC_IRQ_SHOW y
    GENERIC_IRQ_SHOW_LEVEL y
    GENERIC_LIB_DEVMEM_IS_ALLOWED y
    GENERIC_MSI_IRQ y
    GENERIC_MSI_IRQ_DOMAIN y
    GENERIC_PCI_IOMAP y
    GENERIC_PHY y
    GENERIC_PINCONF y
    GENERIC_SCHED_CLOCK y
    GENERIC_SMP_IDLE_THREAD y
    GENERIC_STRNCPY_FROM_USER y
    GENERIC_STRNLEN_USER y
    GENERIC_TIME_VSYSCALL y
    GPIOLIB_IRQCHIP y
    GPIO_CDEV y
    GPIO_DWAPB y
    GPIO_GENERIC y
    GPIO_GENERIC_PLATFORM y
    GPIO_ROCKCHIP y
    GPIO_SYSCON y
    HARDIRQS_SW_RESEND y
    HAS_DMA y
    HAS_IOMEM y
    HAS_IOPORT_MAP y
    HID y
    HID_GENERIC y
    HOTPLUG_CPU y
    HOTPLUG_PCI y
    HOTPLUG_PCI_PCIE y
    HOTPLUG_PCI_SHPC y
    HUGETLBFS y
    HUGETLB_PAGE y
    HWMON y
    HWSPINLOCK y
    HW_CONSOLE y
    HW_RANDOM y
    HW_RANDOM_ROCKCHIP_RK3568 y
    I2C y
    I2C_BOARDINFO y
    I2C_CHARDEV y
    I2C_COMPAT y
    I2C_HELPER_AUTO y
    I2C_RK3X y
    IIO y
    ILLEGAL_POINTER_VALUE 0xdead000000000000
    INDIRECT_PIO y
    INPUT y
    INPUT_EVDEV y
    INPUT_FF_MEMLESS y
    INPUT_KEYBOARD y
    INPUT_LEDS y
    INPUT_MATRIXKMAP y
    INPUT_MOUSE y
    INPUT_MOUSEDEV y
    INPUT_MOUSEDEV_PSAUX y
    INPUT_MOUSEDEV_SCREEN_X 1024
    INPUT_MOUSEDEV_SCREEN_Y 768
    INPUT_RK805_PWRKEY y
    INPUT_SPARSEKMAP y
    IOMMU_API y
    IOMMU_DEFAULT_PASSTHROUGH y
    IOMMU_DMA y
    IOMMU_IOVA y
    IOMMU_IO_PGTABLE y
    IOMMU_IO_PGTABLE_LPAE y
    IOMMU_SUPPORT y
    IRQCHIP y
    IRQ_DOMAIN y
    IRQ_DOMAIN_HIERARCHY y
    IRQ_FORCED_THREADING y
    IRQ_MSI_IOMMU y
    IRQ_TIME_ACCOUNTING y
    IRQ_WORK y
    JBD2 y
    JFFS2_ZLIB y
    JUMP_LABEL y
    KALLSYMS y
    KCMP y
    KEXEC_CORE y
    KEXEC_FILE y
    KSM y
    KVM y
    KVM_GENERIC_DIRTYLOG_READ_PROTECT y
    KVM_MMIO y
    KVM_VFIO y
    LEDS_GPIO y
    LEDS_PWM y
    LEDS_SYSCON y
    LEDS_TRIGGER_CPU y
    LEDS_TRIGGER_PANIC y
    LIBCRC32C y
    LIBFDT y
    LOCALVERSION_AUTO y
    LOCK_DEBUGGING_SUPPORT y
    LOCK_SPIN_ON_OWNER y
    LOG_BUF_SHIFT 19
    MAGIC_SYSRQ y
    MAGIC_SYSRQ_SERIAL y
    MAILBOX y
    MDIO_BUS y
    MDIO_BUS_MUX y
    MDIO_BUS_MUX_GPIO y
    MDIO_BUS_MUX_MMIOREG y
    MDIO_DEVICE y
    MDIO_DEVRES y
    MEMFD_CREATE y
    MEMORY_ISOLATION y
    MFD_CORE y
    MFD_RK808 y
    MFD_RK8XX_I2C y
    MFD_RK8XX_SPI y
    MFD_SYSCON y
    MIGRATION y
    MMC y
    MMC_BLOCK y
    MMC_BLOCK_MINORS 32
    MMC_CQHCI y
    MMC_DW y
    MMC_DW_PLTFM y
    MMC_DW_ROCKCHIP y
    MMC_SDHCI y
    MMC_SDHCI_OF_ARASAN y
    MMC_SDHCI_OF_DWCMSHC y
    MMC_SDHCI_PLTFM y
    MODULES_USE_ELF_RELA y
    MOTORCOMM_PHY y
    MOUSE_PS2 y
    MOUSE_PS2_ALPS y
    MOUSE_PS2_BYD y
    MOUSE_PS2_CYPRESS y
    MOUSE_PS2_LOGIPS2PP y
    MOUSE_PS2_SMBUS y
    MOUSE_PS2_SYNAPTICS y
    MOUSE_PS2_SYNAPTICS_SMBUS y
    MOUSE_PS2_TRACKPOINT y
    MQ_IOSCHED_DEADLINE y
    MTD_CMDLINE_PARTS y
    MTD_SPI_NOR y
    MTD_SPI_NOR_USE_4K_SECTORS y
    MTD_SPLIT_FIRMWARE y
    MUTEX_SPIN_ON_OWNER y
    NEED_DMA_MAP_STATE y
    NEED_SG_DMA_LENGTH y
    NET_FLOW_LIMIT y
    NET_PTP_CLASSIFY y
    NET_SELFTESTS y
    NLS y
    NLS_ISO8859_1 y
    NOP_USB_XCEIV y
    NO_HZ_COMMON y
    NO_HZ_IDLE y
    NR_CPUS 256
    NR_LRU_GENS 7
    NVMEM y
    NVMEM_ROCKCHIP_EFUSE y
    NVMEM_SYSFS y
    NVME_CORE y
    NVME_HWMON y
    OF y
    OF_ADDRESS y
    OF_DYNAMIC y
    OF_EARLY_FLATTREE y
    OF_FLATTREE y
    OF_GPIO y
    OF_IOMMU y
    OF_IRQ y
    OF_KOBJ y
    OF_MDIO y
    OF_OVERLAY y
    OF_RESOLVE y
    PADATA y
    PAGE_POOL y
    PAGE_SIZE_LESS_THAN_256KB y
    PAGE_SIZE_LESS_THAN_64KB y
    PANIC_ON_OOPS_VALUE 0
    PANIC_TIMEOUT 0
    PARTITION_PERCPU y
    PCI y
    PCIEAER y
    PCIEASPM y
    PCIEASPM_EXT y
    PCIEASPM_PERFORMANCE y
    PCIEPORTBUS y
    PCIE_DW y
    PCIE_DW_HOST y
    PCIE_PME y
    PCIE_ROCKCHIP y
    PCIE_ROCKCHIP_DW_HOST y
    PCIE_ROCKCHIP_HOST y
    PCI_DOMAINS y
    PCI_DOMAINS_GENERIC y
    PCI_ECAM y
    PCI_HOST_COMMON y
    PCI_HOST_GENERIC y
    PCI_MSI y
    PCI_MSI_IRQ_DOMAIN y
    PCI_STUB y
    PCS_XPCS y
    PGTABLE_LEVELS 4
    PHYLIB y
    PHYLINK y
    PHYS_ADDR_T_64BIT y
    PHY_ROCKCHIP_DP y
    PHY_ROCKCHIP_EMMC y
    PHY_ROCKCHIP_INNO_USB2 y
    PHY_ROCKCHIP_NANENG_COMBO_PHY y
    PHY_ROCKCHIP_PCIE y
    PHY_ROCKCHIP_SNPS_PCIE3 y
    PHY_ROCKCHIP_TYPEC y
    PHY_ROCKCHIP_USB y
    PINCTRL y
    PINCTRL_RK805 y
    PINCTRL_ROCKCHIP y
    PL330_DMA y
    PLATFORM_MHU y
    PM y
    PM_CLK y
    PM_DEVFREQ y
    PM_GENERIC_DOMAINS y
    PM_GENERIC_DOMAINS_OF y
    PM_OPP y
    POSIX_CPU_TIMERS_TASK_WORK y
    POWER_RESET y
    POWER_SUPPLY y
    POWER_SUPPLY_HWMON y
    PPS y
    PREEMPT_DYNAMIC y
    PREEMPTION y
    PREEMPT_BUILD y
    PREEMPT_COUNT y
    PREEMPT_RCU y
    PRINTK_TIME y
    PROC_PAGE_MONITOR y
    PROC_VMCORE y
    PTP_1588_CLOCK y
    PTP_1588_CLOCK_OPTIONAL y
    PWM y
    PWM_ROCKCHIP y
    PWM_SYSFS y
    QUEUED_RWLOCKS y
    QUEUED_SPINLOCKS y
    QUOTA y
    QUOTACTL y
    RAID_ATTRS y
    RANDOMIZE_BASE y
    RANDOMIZE_MODULE_REGION_FULL y
    RANDSTRUCT_NONE y
    RAS y
    RATIONAL y
    RCU_TRACE y
    REALTEK_PHY y
    REGMAP y
    REGMAP_I2C y
    REGMAP_IRQ y
    REGMAP_MMIO y
    REGULATOR y
    REGULATOR_ARM_SCMI y
    REGULATOR_FAN53555 y
    REGULATOR_FIXED_VOLTAGE y
    REGULATOR_GPIO y
    REGULATOR_PWM y
    REGULATOR_RK808 y
    RELOCATABLE y
    RESET_CONTROLLER y
    RESET_SCMI y
    RFS_ACCEL y
    ROCKCHIP_EFUSE y
    ROCKCHIP_ERRATUM_114514 y
    ROCKCHIP_GRF y
    ROCKCHIP_IODOMAIN y
    ROCKCHIP_IOMMU y
    ROCKCHIP_MBOX y
    ROCKCHIP_PHY y
    ROCKCHIP_PM_DOMAINS y
    ROCKCHIP_THERMAL y
    ROCKCHIP_TIMER y
    ROCKCHIP_VOP y
    ROCKCHIP_VOP2 y
    RODATA_FULL_DEFAULT_ENABLED y
    RPS y
    RSEQ y
    RTC_CLASS y
    RTC_DRV_HYM8563 y
    RTC_DRV_RK808 y
    RTC_I2C_AND_SPI y
    RTC_NVMEM y
    RWSEM_SPIN_ON_OWNER y
    SCHED_MC y
    SCSI y
    SCSI_COMMON y
    SCSI_SAS_ATTRS y
    SCSI_SAS_HOST_SMP y
    SCSI_SAS_LIBSAS y
    SENSORS_ARM_SCMI y
    SENSORS_ARM_SCPI y
    SERIAL_8250_DEPRECATED_OPTIONS y
    SERIAL_8250_DW y
    SERIAL_8250_DWLIB y
    SERIAL_8250_EXAR y
    SERIAL_8250_EXTENDED y
    SERIAL_8250_FSL y
    SERIAL_8250_NR_UARTS 4
    SERIAL_8250_PCI y
    SERIAL_8250_RUNTIME_UARTS 4
    SERIAL_8250_SHARE_IRQ y
    SERIAL_AMBA_PL011 y
    SERIAL_AMBA_PL011_CONSOLE y
    SERIAL_DEV_BUS y
    SERIAL_DEV_CTRL_TTYPORT y
    SERIAL_MCTRL_GPIO y
    SERIAL_OF_PLATFORM y
    SERIO y
    SERIO_AMBAKMI y
    SERIO_LIBPS2 y
    SG_POOL y
    SLUB_DEBUG y
    SMP y
    SOCK_RX_QUEUE_MAPPING y
    SOFTIRQ_ON_OWN_STACK y
    SPARSEMEM y
    SPARSEMEM_EXTREME y
    SPARSEMEM_VMEMMAP y
    SPARSEMEM_VMEMMAP_ENABLE y
    SPARSE_IRQ y
    SPI y
    SPI_BITBANG y
    SPI_DYNAMIC y
    SPI_MASTER y
    SPI_MEM y
    SPI_ROCKCHIP y
    SPI_SPIDEV y
    SQUASHFS_DECOMP_SINGLE y
    SQUASHFS_FILE_CACHE y
    SRAM y
    SRCU y
    STACKDEPOT y
    STACKPROTECTOR y
    STACKPROTECTOR_PER_TASK y
    STACKPROTECTOR_STRONG y
    STACKTRACE y
    STMMAC_ETH y
    STMMAC_PLATFORM y
    STRICT_DEVMEM y
    SWIOTLB y
    SWPHY y
    SYNC_FILE y
    SYSCTL_EXCEPTION_TRACE y
    SYSFS_SYSCALL y
    THERMAL y
    THERMAL_DEFAULT_GOV_STEP_WISE y
    THERMAL_EMERGENCY_POWEROFF_DELAY_MS 0
    THERMAL_EMULATION y
    THERMAL_GOV_POWER_ALLOCATOR y
    THERMAL_GOV_STEP_WISE y
    THERMAL_HWMON y
    THERMAL_OF y
    THREAD_INFO_IN_TASK y
    TICK_CPU_ACCOUNTING y
    TIMER_OF y
    TIMER_PROBE y
    TRACE_CLOCK y
    TRACE_IRQFLAGS_NMI_SUPPORT y
    TRANSPARENT_HUGEPAGE y
    TRANSPARENT_HUGEPAGE_ALWAYS y
    TRANS_TABLE y
    TREE_RCU y
    TREE_SRCU y
    TYPEC y
    TYPEC_FUSB302 y
    TYPEC_TCPM y
    UNINLINE_SPIN_UNLOCK y
    UNMAP_KERNEL_AT_EL0 y
    USB y
    USB_COMMON y
    USB_DWC3 y
    USB_DWC3_HOST y
    USB_DWC3_OF_SIMPLE y
    USB_EHCI_HCD y
    USB_EHCI_HCD_PLATFORM y
    USB_HID y
    USB_OHCI_HCD y
    USB_OHCI_HCD_PLATFORM y
    USB_PHY y
    USB_ROLE_SWITCH y
    USB_STORAGE y
    USB_SUPPORT y
    USB_ULPI y
    USB_ULPI_BUS y
    USB_ULPI_VIEWPORT y
    USB_XHCI_HCD y
    USB_XHCI_PLATFORM y
    VENDOR_FRIENDLYELEC y
    VIRTUALIZATION y
    VMAP_STACK y
    VM_EVENT_COUNTERS y
    VT y
    VT_CONSOLE y
    VT_HW_CONSOLE_BINDING y
    WATCHDOG_CORE y
    XARRAY_MULTI y
    XPS y
    XXHASH y
    XZ_DEC_ARM y
    XZ_DEC_ARMTHUMB y
    XZ_DEC_BCJ y
    ZLIB_DEFLATE y
    ZLIB_INFLATE y
    ZONE_DMA32 y
  '';
in
  buildLinux (args // rec {
    src = fetchTree {
      shallow = true;
      type = "git";
      url = "https://github.com/THMonster/kernel-rockchip";
      ref = "nanopi5-v6.6.25";
      rev = "098ed3d0a7d6bb95b06cb7ca21189891d2fad840";
    };
    # kernelPatches = [
    # ];
    extraConfig = kernelConfig;
    ignoreConfigErrors = true;
    # defconfig = "nanopi5_nixos_defconfig";
    version = "6.6.25";
    modDirVersion = "6.6.25";
    autoModules = true;

  } // (args.argsOverride or { }))
